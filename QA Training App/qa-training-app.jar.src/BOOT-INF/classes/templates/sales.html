<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <title>QA Training App | Sales</title>
  <link rel="stylesheet"
        href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
        rel="stylesheet">
  <link rel="stylesheet" th:href="@{/css/app.css}">
</head>

<body>

<div th:replace="layout :: layout">

  <div th:fragment="content">

    <h3 class="mb-4">Sales</h3>


    <a href="/ui/sales/new"
       class="btn btn-primary btn-sm mb-3"
       th:if="${isAdmin}">
      Sell Plant
    </a>
    <div th:if="${successMessage}" class="alert alert-success">
      <i class="bi bi-check-circle me-1"></i>
      <span th:text="${successMessage}"></span>
    </div>

    <div th:if="${errorMessage}" class="alert alert-danger">
      <i class="bi bi-exclamation-triangle me-1"></i>
      <span th:text="${errorMessage}"></span>
    </div>


    <table class="table table-bordered table-striped align-middle">
      <thead class="table-dark">
      <tr>

        <th>
          <a class="text-white text-decoration-none"
             th:href="@{/ui/sales(
                         page=0,
                         sortField='plant.name',
                         sortDir=${sortDir == 'asc' ? 'desc' : 'asc'}
                       )}">
            Plant
          </a>
        </th>

        <th>
          <a class="text-white text-decoration-none"
             th:href="@{/ui/sales(
                         page=0,
                         sortField='quantity',
                         sortDir=${sortDir == 'asc' ? 'desc' : 'asc'}
                       )}">
            Quantity
          </a>
        </th>

        <th>
          <a class="text-white text-decoration-none"
             th:href="@{/ui/sales(
                         page=0,
                         sortField='totalPrice',
                         sortDir=${sortDir == 'asc' ? 'desc' : 'asc'}
                       )}">
            Total Price
          </a>
        </th>

        <th>
          <a class="text-white text-decoration-none"
             th:href="@{/ui/sales(
                         page=0,
                         sortField='soldAt',
                         sortDir=${sortDir == 'asc' ? 'desc' : 'asc'}
                       )}">
            Sold At
          </a>
        </th>

        <th th:if="${isAdmin}">Actions</th>
      </tr>
      </thead>

      <tbody>
      <tr th:each="s : ${sales}">
        <td th:text="${s.plant.name}"></td>
        <td th:text="${s.quantity}"></td>
        <td th:text="${#numbers.formatDecimal(s.totalPrice,1,2)}"></td>
        <td th:text="${#temporals.format(s.soldAt,'yyyy-MM-dd HH:mm')}"></td>

        <td th:if="${isAdmin}">
          <form th:action="@{/ui/sales/delete/{id}(id=${s.id})}"
                method="post"
                onsubmit="return confirm('Are you sure you want to delete this sale?');">

            <button class="btn btn-sm btn-outline-danger">
              <i class="bi bi-trash"></i>
            </button>
          </form>
        </td>


      <tr th:if="${sales == null or #lists.isEmpty(sales)}">
        <td colspan="5" class="text-center text-muted">
          No sales found
        </td>
      </tr>
      </tbody>
    </table>

    <!-- Pagination -->
    <nav th:if="${page.totalPages > 1}">
      <ul class="pagination">

        <li class="page-item"
            th:classappend="${page.first} ? 'disabled'">
          <a class="page-link"
             th:href="@{/ui/sales(
                         page=${page.number - 1},
                         sortField=${sortField},
                         sortDir=${sortDir}
                       )}">
            Previous
          </a>
        </li>

        <li class="page-item"
            th:each="i : ${#numbers.sequence(0, page.totalPages - 1)}"
            th:classappend="${i == page.number} ? 'active'">
          <a class="page-link"
             th:href="@{/ui/sales(
                         page=${i},
                         sortField=${sortField},
                         sortDir=${sortDir}
                       )}"
             th:text="${i + 1}">
          </a>
        </li>

        <li class="page-item"
            th:classappend="${page.last} ? 'disabled'">
          <a class="page-link"
             th:href="@{/ui/sales(
                         page=${page.number + 1},
                         sortField=${sortField},
                         sortDir=${sortDir}
                       )}">
            Next
          </a>
        </li>

      </ul>
    </nav>

  </div>
</div>

</body>
</html>
